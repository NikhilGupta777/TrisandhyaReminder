version: 1
frontend:
  phases:
    preBuild:
      commands:
        # Set Node 18 (required for Gen 2)
        - nvm install 18
        - node -v
        # Install root dependencies (where react-native-webview lives)
        # This fixes the peer dependency conflict
        - npm ci --legacy-peer-deps
    build:
      commands:
        # Run the build script from the ROOT directory
        # This will build your Vite app (client) AND your esbuild server
        - npm run build
  artifacts:
    # Point to the Vite build output, relative to the ROOT
    baseDirectory: client/dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/* # Cache root node_modules
      - client/node_modules/**/* # Cache client node_modules (if any)
# Enforce Node 18 for the build environment
environmentVariables:
  - variable: NODE_VERSION
    value: "18"